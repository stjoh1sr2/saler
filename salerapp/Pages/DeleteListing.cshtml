@page
@model salerapp.Pages.DeleteListingModel
@{
    ViewData["Title"] = "Edit Listing";
    Listing listing = new Listing();

    // Redirect if no user is currently logged in; else load listing information
    if (HttpContextAccessor.HttpContext.Session.GetString("_User") is null)
    {
        Response.Redirect("/");
    }
    else
    {
        listing = Model.LoadListing(Int32.Parse(Request.Query["id"].ToString()));
    }

    @if (JsonConvert.DeserializeObject<User>(HttpContext.Session.GetString("_User")) is not null)
    {
        // Ensure current user matches the poster of the listing
        if (JsonConvert.DeserializeObject<User>(HttpContext.Session.GetString("_User")).UserId == listing.PosterId)
        {
            <!-- Main form -->
            <main class="form w-100 m-auto text-center container" style="margin-left: 37.5%; margin-right: 37.5%;">
                <form style="margin-left: 12.5%; margin-right: 12.5%; margin-top: 5%;" method="post">
                    <h3 class="display-6 fw-bold lh-1 mb-4" style="text-align:center;"> Are you sure you want to delete this listing?</h3>

                    <!-- Hidden input for post -->
                    <input type="hidden" name="listing.ListingId" value="@listing.ListingId" />
                    <input type="hidden" name="listing.PosterId" value="@listing.PosterId" />

                    <div>
                        <a role="button" class="w-100 btn btn-lg btn-secondary" style="margin-top: 5px; max-width: 300px;" href="@Url.Content("/mylistings")">Cancel</a>
                    </div>
                    <div>
                        <button class="w-100 btn btn-lg btn-danger" style="margin-top: 5px; max-width: 300px;" type="submit">Delete Listing</button>
                    </div>
                </form>
            </main>
        }
        else
        {
            // Redirect to Home page
            Response.Redirect("/");
        }
    }
}